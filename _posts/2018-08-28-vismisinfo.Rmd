---
title: "Lo mostrado y lo implicado"
output:
  tufte::tufte_html: default
  tufte::tufte_handout: default
author: "Thomas Brochhagen"
date: "`r Sys.Date()`"
runtime: shiny
---
```{r setup, include=FALSE}
library(tufte)
# invalidate cache when the tufte version changes
knitr::opts_chunk$set(tidy = FALSE, cache.extra = packageVersion('tufte'))
options(htmltools.dir.version = FALSE)
pdf.options(encoding='ISOLatin2')
```

# TO DO
* Recortar Pi침era con grafico y poner como marginnote
* Texto: Preambulo, explicaci칩n, proporcionalidad, shiny ejemplo 1A (Pi침i), ejemplo 1B (CASE), ejemplo 2 (CASE)
* Shiny para modificar proporciones en 1A en una escala de real a Pi침era


"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."

```{r, echo=FALSE}
library("ggplot2"); theme_set(theme_light())
d1 <- data.frame("percent" = c(30.7, 22.8,27.3),
                    "year" = c("2010", "2013", "2016"))
myred <- 'red'
myblue <- 'blue'
myalpha <- 0.75
```

```{r fig-margin, fig.margin = TRUE, fig.cap = "Barras `reales` proporcionales.", fig.width=3.5, fig.height=3.5, cache=TRUE, message=FALSE, echo=FALSE}
ggplot(d1, aes(x = year, y = percent, fill = c('na','ba','na'))) +
            geom_bar(stat="identity", position = "dodge", alpha = myalpha) +
            scale_fill_manual(values=c(myblue, myred)) +
            theme(legend.position="none") + # remove legend (that comes from dummy categories)
            geom_text(aes(label=percent), vjust=3.6, color="white", size=8) +
            theme(axis.title.x=element_blank(),
                  axis.title.y=element_blank(),
                  axis.text.x = element_text(size=14),
                  axis.text.y = element_text(size=14))
```


"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."



```{r, echo = FALSE}
library("shiny")
perc2010 <- 0.307
perc2013 <- 0.228
perc2016 <- 0.273

stepval <- 5

# Define UI for application that draws a histogram
ui <- fluidPage(
  
  # Application title
#  titlePanel("Delincuencia"),
  
  # Sidebar with a slider input for number of bins 
  sidebarLayout(
    sidebarPanel(
      sliderInput(inputId = "n2010",
                   "2010:",
                   min = 0, max = 100,
                   value = round(perc2010,2) * 100,
                   step = stepval),
      
      sliderInput(inputId = "n2013",
                   "2013:",
                   min = 0, max = 100,
                   value = round(perc2013,2) * 100,
                   step = stepval),
      
      sliderInput(inputId = "n2016",
                   "2016:",
                   min = 0, max = 100,
                   value = round(perc2016,2) * 100,
                   step = stepval)
    ),
    
    # Show a plot of the generated distribution
    mainPanel(
      plotOutput("barplot")
    )
  )
)


# Define server logic required to draw a histogram
server <- function(input, output) {

  
  output$barplot <- renderPlot({
    ggplot(d1, aes(x = year, y = c(input$n2010,input$n2013, input$n2016), fill = c('na','ba','na'))) +
      geom_bar(stat="identity", position = "dodge", alpha = myalpha) +
      scale_fill_manual(values=c(myblue, myred)) +
      theme(legend.position="none") + # remove legend (that comes from dummy categories)
      geom_text(aes(label=c(paste(input$n2010,"%"),
                            paste(input$n2013,"%"),
                            paste(input$n2016,"%"))),
                    vjust=3.6, color="white", size=8) +
      theme(axis.title.x=element_blank(),
            axis.title.y=element_blank(),
            axis.text.x = element_text(size=14),
            axis.text.y = element_text(size=14))
  })
}

# Run the application 
shinyApp(ui = ui, server = server,
         options = list(width = "90%")
)
```


"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."